<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Loading and processing data • tools4watlas</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Loading and processing data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tools4watlas</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/basic_work_flows.html">Basic workflow</a></li>
    <li><a class="dropdown-item" href="../articles/load_and_process_data.html">Loading and processing data</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/allertbijleveld/tools4watlas/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Loading and processing data</h1>
                        <h4 data-toc-skip class="author">Allert
Bijleveld &amp; Johannes Krietsch</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/allertbijleveld/tools4watlas/blob/master/vignettes/load_and_process_data.Rmd" class="external-link"><code>vignettes/load_and_process_data.Rmd</code></a></small>
      <div class="d-none name"><code>load_and_process_data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="basic-workflow">Basic workflow<a class="anchor" aria-label="anchor" href="#basic-workflow"></a>
</h2>
<p>The basic workflow using <em>tools4watlas</em> for high-throughput
WATLAS tracking-data is getting data, basic filtering, processing,
cleaning, adding environmental data and selecting data.</p>
<p>After installing the package, load the <em>tools4watlas</em>
library.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/allertbijleveld/tools4watlas" class="external-link">tools4watlas</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="getting-data">Getting data<a class="anchor" aria-label="anchor" href="#getting-data"></a>
</h3>
<p>You can get data from locally from a csv or SQLite file, or remote
SQL database server.</p>
<div class="section level4">
<h4 id="local-csv-file">Local csv file<a class="anchor" aria-label="anchor" href="#local-csv-file"></a>
</h4>
<p>The function atl_get_data_csv() is a convenient wrapper to load a csv
file as a data frame. By default it loads the csv file provided as
example data with tools4watlas.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/atl_get_data_csv.html">atl_get_data_csv</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading file: /home/runner/work/_temp/Library/tools4watlas/extdata/redknot_2707_WATLAS_exampledata.csv</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="sql-database">SQL database<a class="anchor" aria-label="anchor" href="#sql-database"></a>
</h4>
<p>First select the tags and time period.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Tags for which data should be extracted form the database</span></span>
<span><span class="va">tags</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2707</span>, <span class="fl">2708</span><span class="op">)</span></span>
<span><span class="va">tags</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/atl_full_tag_id.html">atl_full_tag_id</a></span><span class="op">(</span><span class="va">tags</span><span class="op">)</span> <span class="co"># Change to long tag format (as in database)</span></span>
<span></span>
<span><span class="co"># Time period for which data should be extracted form the database</span></span>
<span><span class="va">from</span> <span class="op">&lt;-</span> <span class="st">"2023-01-01 12:00:00"</span></span>
<span><span class="va">to</span>   <span class="op">&lt;-</span> <span class="st">"2024-01-01 12:00:00"</span></span></code></pre></div>
<p>Alternatively, this selection can also be based on the
tags_watlas_all.xlsx file (including metadata of all tags) and the time
period can be specified as last days (only useful when accessing remote
SQL database)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load Excel file </span></span>
<span>  <span class="co"># provide the correct path and file name, and sheet of the excel file. </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org" class="external-link">readxl</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">alltags</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu">read_excel</span><span class="op">(</span><span class="st">"C:\\path\\tags_watlas_all.xlsx"</span>, </span>
<span>                              sheet <span class="op">=</span> <span class="st">"tags_watlas_all"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/data.table/man/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Subset tag ID's using data.table </span></span>
<span><span class="co"># (For example red knots, dunlin and sanderling tagged in 2023)</span></span>
<span><span class="va">tags</span> <span class="op">&lt;-</span> <span class="va">alltags</span><span class="op">[</span><span class="va">season</span> <span class="op">==</span> <span class="fl">2023</span> <span class="op">&amp;</span> </span>
<span>                 <span class="va">species</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red knot"</span>, <span class="st">"dunlin"</span>, <span class="st">"sanderling"</span><span class="op">)</span><span class="op">]</span><span class="op">$</span><span class="va">tagID</span></span>
<span></span>
<span><span class="co"># Change to long tag format</span></span>
<span><span class="va">tags</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/atl_full_tag_id.html">atl_full_tag_id</a></span><span class="op">(</span><span class="va">tags</span><span class="op">)</span> <span class="co"># Change to long tag format (as in database)</span></span>
<span></span>
<span><span class="co"># Select N last days to get data from</span></span>
<span><span class="va">days</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">from</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">86400</span> <span class="op">*</span> <span class="va">days</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">to</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fl">3600</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="section level5">
<h5 id="local-sqlite-file">Local SQLite file<a class="anchor" aria-label="anchor" href="#local-sqlite-file"></a>
</h5>
<p>First, the path and file name of the local SQLite database need to be
provided. Then, with the established connection, the database can be
queried for the selected tags and period. Here we will load the tagging
data in a list where each entry is a dataframe with data of one tag.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SQLiteDB</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"path"</span>, <span class="st">"SQLite_db_name"</span>, <span class="st">".sqlite"</span><span class="op">)</span></span>
<span><span class="va">MyDBconnection</span> <span class="op">&lt;-</span> <span class="fu">RSQLite</span><span class="fu">::</span><span class="fu">dbConnect</span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span>,<span class="va">SQLiteDB</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ldf_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="va">tags</span>, </span>
<span>  <span class="va">atl_get_data</span>, </span>
<span>  tracking_time_start <span class="op">=</span> <span class="va">from</span>, </span>
<span>  tracking_time_end <span class="op">=</span> <span class="va">to</span>, </span>
<span>  timezone <span class="op">=</span> <span class="st">"CET"</span>, </span>
<span>  SQLiteDB <span class="op">=</span> <span class="va">mydb</span>, </span>
<span>  use_connection <span class="op">=</span> <span class="va">MyDBconnection</span></span>
<span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level5">
<h5 id="remote-sql-database">Remote SQL-database<a class="anchor" aria-label="anchor" href="#remote-sql-database"></a>
</h5>
<p>It is also possible to connect directly to a remote host.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ldf_raw</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="va">tags</span>, </span>
<span>  <span class="va">atl_get_data</span>,</span>
<span>  tracking_time_start <span class="op">=</span> <span class="va">from</span>,</span>
<span>  tracking_time_end <span class="op">=</span> <span class="va">to</span>,</span>
<span>  timezone <span class="op">=</span> <span class="st">"CET"</span>,</span>
<span>  host<span class="op">=</span> <span class="st">"host"</span>, </span>
<span>  database <span class="op">=</span> <span class="st">"db"</span>,</span>
<span>  username <span class="op">=</span> <span class="st">"username"</span>,</span>
<span>  password <span class="op">=</span> <span class="st">"password"</span></span>
<span><span class="op">)</span>             </span></code></pre></div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="data-explanation">Data explanation<a class="anchor" aria-label="anchor" href="#data-explanation"></a>
</h3>
<p>The resulting loaded WATLAS data will look like this:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="6%">
<col width="11%">
<col width="5%">
<col width="11%">
<col width="21%">
<col width="9%">
<col width="8%">
<col width="4%">
<col width="7%">
<col width="7%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="right">posID</th>
<th align="right">TAG</th>
<th align="left">tag</th>
<th align="right">TIME</th>
<th align="left">time</th>
<th align="right">X</th>
<th align="right">Y</th>
<th align="right">NBS</th>
<th align="right">VARX</th>
<th align="right">VARY</th>
<th align="right">COVXY</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">3.1001e+10</td>
<td align="left">2707</td>
<td align="right">1662074702</td>
<td align="left">2022-09-01 23:25:02</td>
<td align="right">649777.3</td>
<td align="right">5902912</td>
<td align="right">4</td>
<td align="right">54.52</td>
<td align="right">136.33</td>
<td align="right">2.50</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">3.1001e+10</td>
<td align="left">2707</td>
<td align="right">1662074705</td>
<td align="left">2022-09-01 23:25:05</td>
<td align="right">649767.2</td>
<td align="right">5902940</td>
<td align="right">4</td>
<td align="right">58.67</td>
<td align="right">126.27</td>
<td align="right">4.73</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">3.1001e+10</td>
<td align="left">2707</td>
<td align="right">1662074708</td>
<td align="left">2022-09-01 23:25:08</td>
<td align="right">649760.1</td>
<td align="right">5902922</td>
<td align="right">3</td>
<td align="right">51.63</td>
<td align="right">447.38</td>
<td align="right">19.42</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">3.1001e+10</td>
<td align="left">2707</td>
<td align="right">1662074711</td>
<td align="left">2022-09-01 23:25:11</td>
<td align="right">649779.7</td>
<td align="right">5902906</td>
<td align="right">3</td>
<td align="right">169.19</td>
<td align="right">176.24</td>
<td align="right">-34.99</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">3.1001e+10</td>
<td align="left">2707</td>
<td align="right">1662074717</td>
<td align="left">2022-09-01 23:25:17</td>
<td align="right">649760.0</td>
<td align="right">5902951</td>
<td align="right">3</td>
<td align="right">56.16</td>
<td align="right">489.10</td>
<td align="right">6.66</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">3.1001e+10</td>
<td align="left">2707</td>
<td align="right">1662074720</td>
<td align="left">2022-09-01 23:25:20</td>
<td align="right">649760.0</td>
<td align="right">5902898</td>
<td align="right">4</td>
<td align="right">54.61</td>
<td align="right">143.40</td>
<td align="right">-2.69</td>
</tr>
</tbody>
</table>
<p>Loading the WATLAS data will provide a data frame with different
columns representing:</p>
<table class="table">
<colgroup>
<col width="16%">
<col width="84%">
</colgroup>
<thead><tr class="header">
<th>Column</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><em>PosID</em></td>
<td>Unique number for localizations</td>
</tr>
<tr class="even">
<td><em>TAG</em></td>
<td>11 digit WATLAS tag ID</td>
</tr>
<tr class="odd">
<td><em>tag</em></td>
<td>4 digit tag number (character), i.e. last 4 digits of the column
‘TAG’</td>
</tr>
<tr class="even">
<td><em>TIME</em></td>
<td>UNIX time (seconds)</td>
</tr>
<tr class="odd">
<td><em>time</em></td>
<td>Timestamp in POSIXct (UTC)</td>
</tr>
<tr class="even">
<td><em>X</em></td>
<td>X-ccordinates in meters (utm 31 N)</td>
</tr>
<tr class="odd">
<td><em>Y</em></td>
<td>Y-ccordinates in meters (utm 31 N)</td>
</tr>
<tr class="even">
<td><em>NBS</em></td>
<td>Number of Base Stations used in calculating coordinates</td>
</tr>
<tr class="odd">
<td><em>VARX</em></td>
<td>Variance in estimating X-coordinates</td>
</tr>
<tr class="even">
<td><em>VARY</em></td>
<td>Variance in estimating Y-coordinates</td>
</tr>
<tr class="odd">
<td><em>COVXY</em></td>
<td>Co-variance between X- and Y-coordinates</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="spatiotemporal-filtering">Spatiotemporal filtering<a class="anchor" aria-label="anchor" href="#spatiotemporal-filtering"></a>
</h3>
<p>After getting the data, a potential first step is applying basic
filtering to select certain areas of interest, or remove areas with
erroneous localizations.</p>
<p>Here, is an example of removing hypothesized erroneous localizations
from a rectangular area specified with the range in x and y coordinates,
but a spatial polygon could also be used (see
<em>?atl_filter_bounds</em>).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># @ALLERT make run on lists? This does not seem to work</span></span>
<span><span class="va">ldf_filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="va">ldf_raw</span>,</span>
<span>  <span class="va">atl_filter_bounds</span>,</span>
<span>  x_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">639470</span>, <span class="fl">639471</span><span class="op">)</span>,</span>
<span>  y_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5887143</span>, <span class="fl">5887144</span><span class="op">)</span>,</span>
<span>  sf_polygon <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  remove_inside <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For filtering data, the general <em>atl_filter_covariates</em>
function can also be used. For example, filtering on a range of
coordinates and a time period:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ldf_filtered</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="va">ldf_raw</span>, </span>
<span>    <span class="va">atl_filter_covariates</span>,</span>
<span>  filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"between(time, '2022-09-02 01:25:00', '2022-09-03 13:47:00')"</span>,</span>
<span>      <span class="st">"between(X, 649686, 651938)"</span></span>
<span>    <span class="op">)</span> </span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="basic-processing">Basic processing<a class="anchor" aria-label="anchor" href="#basic-processing"></a>
</h3>
<p>With the data of interest, some basic variables can be calculated,
for instance, calculating speeds and turning angles from consecutive
localizations. Speed can then later be used for filtering potentially
erroneous localizations.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># @ALLERT make run on lists? This does not seem to work</span></span>
<span></span>
<span><span class="co"># Calculate speed between consecutive localizations         </span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">speed_in</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/atl_get_speed.html">atl_get_speed</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, time <span class="op">=</span> <span class="st">"TIME"</span>, type <span class="op">=</span> <span class="st">"in"</span><span class="op">)</span> </span>
<span><span class="va">data</span><span class="op">$</span><span class="va">speed_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/atl_get_speed.html">atl_get_speed</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, time <span class="op">=</span> <span class="st">"TIME"</span>, type <span class="op">=</span> <span class="st">"out"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">#  Calculate angle between consecutive localizations        </span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">angle</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/atl_turning_angle.html">atl_turning_angle</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, time <span class="op">=</span> <span class="st">"TIME"</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="filtering">Filtering<a class="anchor" aria-label="anchor" href="#filtering"></a>
</h3>
<p>The next step is to remove localization errors, for instance, by
applying basic filtering on the variances in estimating x- and
y-coordinates and speed.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">VARmax</span>  <span class="op">&lt;-</span> <span class="fl">5000</span> <span class="co"># variance in meters squared</span></span>
<span><span class="va">speed_max</span> <span class="op">&lt;-</span> <span class="fl">35</span> <span class="co"># meters per second</span></span>
<span></span>
<span><span class="co"># ldf_clean &lt;- lapply(</span></span>
<span><span class="co">#   ldf_raw, </span></span>
<span><span class="co">#   atl_filter_covariates,</span></span>
<span><span class="co">#   filters = c(</span></span>
<span><span class="co">#     "VARX &lt; VARmax", </span></span>
<span><span class="co">#       "VARY &lt; VARmax",</span></span>
<span><span class="co">#       "speed_in &lt; speed_max",</span></span>
<span><span class="co">#       "speed_out &lt; speed_max"</span></span>
<span><span class="co">#       )</span></span>
<span><span class="co">#   )</span></span>
<span></span>
<span><span class="va">VARmax</span>  <span class="op">&lt;-</span> <span class="fl">5000</span> <span class="co"># Variance limit in meters squared</span></span>
<span></span>
<span><span class="va">ldf_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="va">ldf_raw</span>, </span>
<span>    <span class="va">atl_filter_covariates</span>,</span>
<span>    filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"VARX &lt; VARmax"</span>, </span>
<span>        <span class="st">"VARY &lt; VARmax"</span></span>
<span>        <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="smoothing">Smoothing<a class="anchor" aria-label="anchor" href="#smoothing"></a>
</h3>
<p>To further reduce error in the localization data, a basic smoother
such as a median filter can be applied.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">med_filter</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="co"># number of localizations within window for smoothing</span></span>
<span></span>
<span><span class="va">ldf_smoothed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="va">ldf_clean</span>,</span>
<span>  <span class="va">atl_median_smooth</span>,</span>
<span>  time <span class="op">=</span> <span class="st">"TIME"</span>, </span>
<span>  moving_window <span class="op">=</span> <span class="va">med_filter</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>After smoothing the data, the speeds and angles need to be
recalculated.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span><span class="op">$</span><span class="va">speed_in</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/atl_get_speed.html">atl_get_speed</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, time <span class="op">=</span> <span class="st">"TIME"</span>, type <span class="op">=</span> <span class="st">"in"</span><span class="op">)</span> </span>
<span><span class="va">data</span><span class="op">$</span><span class="va">speed_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/atl_get_speed.html">atl_get_speed</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, time <span class="op">=</span> <span class="st">"TIME"</span>, type <span class="op">=</span> <span class="st">"out"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">#&gt; Note that the distance between smooted localization can be zero, and </span></span>
<span><span class="co">#&gt; therefore, the angle cannot be calculated and a warning and NaNs are returned    </span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">angle</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/atl_turning_angle.html">atl_turning_angle</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, time <span class="op">=</span> <span class="st">"TIME"</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adding-tidal-data">Adding tidal data<a class="anchor" aria-label="anchor" href="#adding-tidal-data"></a>
</h3>
<p>After following the above basic steps, the data will be ready for
adding environmental data, such as waterlevels.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&gt; load the tidal data using the library data.table</span></span>
<span><span class="va">tides_filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"example_tide_data_UTC.csv"</span>, </span>
<span>                              package<span class="op">=</span><span class="st">"tools4watlas"</span><span class="op">)</span></span>
<span><span class="va">tide_data_highres_filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, </span>
<span>                                          <span class="st">"example_tide_data_highres_UTC.csv"</span>, </span>
<span>                                          package <span class="op">=</span> <span class="st">"tools4watlas"</span><span class="op">)</span></span>
<span><span class="va">tides</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="va">tides_filename</span><span class="op">)</span></span>
<span><span class="va">tide_data_highres</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/data.table/man/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="va">tide_data_highres_filename</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#&gt; add the tidal data to the tracking data. Note that we use an offset </span></span>
<span><span class="co">#&gt; of 30 min becasue of the delay in water flow between the tidal gauge </span></span>
<span><span class="co">#&gt; and the location of the example tracking data (the islet of Griend)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/atl_add_tidaldata.html">atl_add_tidaldata</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, </span>
<span>                          tide_data <span class="op">=</span> <span class="va">tides</span>, </span>
<span>                          tide_data_highres <span class="op">=</span> <span class="va">tide_data_highres</span>, </span>
<span>                          waterdata_resolution <span class="op">=</span> <span class="st">"10 minute"</span>, </span>
<span>                          Offset <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-selection">Data selection<a class="anchor" aria-label="anchor" href="#data-selection"></a>
</h3>
<p>For specific analyses, the cleaned data can be selected. To select
localizations when mudlfats are available for foraging, we can for
example select a low tide period from -2.5 hours to +2.5 hours around
low tide <a href="https://royalsocietypublishing.org/doi/10.1098/rspb.2015.1557" class="external-link">(Bijleveld
et al. 2016)</a>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#&gt; select the low tide periode for a particular tide as specified by tideID </span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/atl_filter_covariates.html">atl_filter_covariates</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">data</span>,</span>
<span>    filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"tideID == 2022472"</span>,</span>
<span>    <span class="st">"between(time2lowtide, -2.5 * 60, 2.5 * 60)"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Allert Bijleveld, Pratik Gupte, Christine Beardsworth.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
